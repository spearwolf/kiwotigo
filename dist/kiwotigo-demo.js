!function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function n(n){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?t(Object(r),!0).forEach((function(t){e(n,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}))}return n}function o(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var a,c,s,u,l=new Map,d=(u=0,function(){return++u,"kiwotigo-".concat(u.toString(36))}),f=function(){return a||((a=new Worker("kiwotigo.worker.js")).onmessage=function(e){var t=e.data,n=t.id,o=t.type,r=l.get(n);if(r)switch(o){case"progress":r.onProgressFn&&r.onProgressFn(t.progress);break;case"result":l.delete(n),delete t.type,t.originData&&localStorage.setItem("kiwotigoOriginData","string"==typeof t.originData?t.originData:JSON.stringify(t.originData)),r.resolve(t),s&&(c={type:"build",data:t},s.postMessage(c));break;default:console.warn("unknown message type:",o,t)}}),a};function g(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.forEach((function(t){var r=t[n];e.beginPath(),e.moveTo(r[0],r[1]);for(var i=r.length>>1,a=1;a<i;a++)e.lineTo(r[a<<1],r[1+(a<<1)]);e.closePath(),e.fill(),o&&e.stroke()}))}function h(e){var t=e.ctx,n=e.icf,r=o(e,["ctx","icf"]);!function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}(t),r.drawRegionBoundingBoxes&&function(e,t){var n=t.regions;e.strokeStyle="#f0f0f0",n.forEach((function(t){var n=t.bBox;e.beginPath(),e.rect(n.left,n.top,n.width,n.height),e.stroke()}))}(t,n),function(e,t,n){e.strokeStyle="#a5a5a5",e.lineWidth=1,e.fillStyle="#f5f5f5",g(e,t.regions,"fullPath",!0),n&&(e.fillStyle="#e7e7e7",g(e,t.regions,"basePath"))}(t,n,r.drawRegionBasePaths),r.drawRegionsBase&&function(e,t){e.lineWidth=1,t.regions.forEach((function(t){var n=t.centerPoint;e.strokeStyle="#a9a9a9",e.setLineDash([]),e.beginPath(),e.arc(n.x,n.y,n.iR,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.strokeStyle="#cacaca",e.setLineDash([5,15,25]),e.beginPath(),e.arc(n.x,n.y,n.oR,0,2*Math.PI,!1),e.closePath(),e.stroke()}))}(t,n),r.drawRegionConnections&&function(e,t){e.setLineDash([]),e.strokeStyle="#f5b",e.lineWidth=3;var n=new Set;t.regions.forEach((function(o){o.neighbors.forEach((function(r){var i=o.id<r?"".concat(o.id,";").concat(r):"".concat(r,";").concat(o.id);if(!n.has(i)){n.add(i);var a=function(e,t){return e.regions[t]}(t,r),c=o.islandId!==a.islandId;e.setLineDash(c?[3,6]:[]),e.beginPath(),e.moveTo(o.centerPoint.x,o.centerPoint.y),e.lineTo(a.centerPoint.x,a.centerPoint.y),e.closePath(),e.stroke()}}))})),e.setLineDash([])}(t,n),r.drawRegionIds&&function(e,t){e.font="bold 36px sans-serif",e.shadowColor="#fff",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=4,e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",t.regions.forEach((function(t,n){var o=t.centerPoint,r=o.x,i=o.y;e.fillText("".concat(n),r,i)}))}(t,n)}var y,m=document.getElementById("kiwotigoCanvas"),p=m.getContext("2d"),b=["I will now create a new world just for you ...","Such a thing can take a while, though ...","... each country must be carefully considered ...","Hold on, it can't be much longer ...","I'm almost finished, there's just a few final touches ..."],v=function(e){document.querySelector(".loadingModal-info").innerHTML=e},w=0,S=0,P=function(e){var t=document.querySelector(".loadingModal-content").getBoundingClientRect().width;document.querySelector(".loadingModal-progress").style.width="".concat(Math.round(e*t),"px")},O=function(){return document.querySelector(".kiwotigo-form-justUpdate")},k=function(){var e={};return Array.from(document.querySelectorAll(".mapLegendContainer input[type=checkbox]")).forEach((function(t){e[t.name]=t.checked})),e},x=function(e){h(y=n(n(n({},y),e),k()))},j=function(e){v(b[0]),w=1,document.querySelector(".loadingModal").classList.add("loading"),clearInterval(S),S=setInterval((function(){v(b[w]),w=(w+1)%b.length}),5e3),function(e,t){return new Promise((function(o){var r=d();l.set(r,{resolve:o,onProgressFn:t}),f().postMessage(n(n({},e),{},{id:r}))}))}(e,P).then((function(e){console.log("received new build",e),clearInterval(S),P(1),setTimeout((function(){document.querySelector(".loadingModal").classList.remove("loading")}),500),O().disabled=!1,document.querySelector(".mapLegendContainer").style.display="block",m.width=e.continent.canvasWidth,m.height=e.continent.canvasHeight,x({ctx:p,icf:e.continent})}))},L=function(){var t=document.forms.kiwotigo.elements;return["gridWidth","gridHeight","gridOuterPaddingX","gridOuterPaddingY","gridInnerPaddingX","gridInnerPaddingY","gridHexWidth","gridHexHeight","hexWidth","hexHeight","hexPaddingX","hexPaddingY","minimalGrowIterations","fastGrowIterations","maxRegionSizeFactor","probabilityCreateRegionAt","maxExtendedOuterRangeFactor","canvasMargin"].reduce((function(o,r){return n(n({},o),{},e({},r,parseFloat(t[r].value)))}),{})},E=function(){return localStorage.getItem("kiwotigoOriginData")};document.forms.kiwotigo.addEventListener("submit",(function(e){e.preventDefault(),O().checked?j(n(n({},L()),{},{originData:E()})):j(L()),document.querySelector(".kiwotigo-createContinentBtn").blur()})),document.addEventListener("DOMContentLoaded",(function(){var e=E();if(e){O().disabled=!1;var t=JSON.parse(e).config;j(n(n({},t),{},{originData:e})),Array.from(Object.entries(t)).forEach((function(e){var t=r(e,2),n=t[0],o=t[1],i=document.querySelector(".kiwotigo-form input[name=".concat(n,"]"));i&&(i.value=o)}))}else O().disabled=!0,document.querySelector(".mapLegendContainer").style.display="none"})),document.querySelector(".openCloseAction").addEventListener("pointerup",(function(){document.querySelector(".createContinentConfig").classList.toggle("opened")})),O().addEventListener("change",(function(){var e=O().checked;Array.from(document.querySelectorAll(".kiwotigo-form .create-only input")).forEach((function(t){t.disabled=e})),document.querySelector(".kiwotigo-form").classList[e?"add":"remove"]("just-update")})),document.querySelector(".mapLegendContainer").addEventListener("change",(function(){console.debug("legend options",k()),x(k())})),document.body.addEventListener("pointerup",(function(e){var t=e.target;if("LABEL"===t.tagName){var n=t.getAttribute("for"),o=document.querySelector("input[name=".concat(n,"]"));o&&"checkbox"===o.type&&o.click()}})),s||"undefined"==typeof BroadcastChannel||((s=new BroadcastChannel("kiwotigo")).onmessage=function(e){var t=e.data;if(t)switch(t.type){case"publishBuild":c&&s.postMessage(c);break;case"ping":s.postMessage({type:"pong"})}},c&&s.postMessage(c))}();
//# sourceMappingURL=kiwotigo-demo.js.map
