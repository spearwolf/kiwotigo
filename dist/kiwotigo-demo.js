!function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function n(n){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{};o%2?t(Object(i),!0).forEach((function(t){e(n,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))}))}return n}var o,i=new Worker("kiwotigo.worker.js"),r=new Map,a=(o=0,function(){return++o,"kiwotigo-".concat(o.toString(36))});i.onmessage=function(e){var t=e.data,n=t.id,o=t.type,i=r.get(n);if(i)switch(o){case"progress":i.onProgressFn&&i.onProgressFn(t.progress);break;case"result":r.delete(n),delete t.type,t.originData&&localStorage.setItem("kiwotigoOriginData","string"==typeof t.originData?t.originData:JSON.stringify(t.originData)),i.resolve(t);break;default:console.warn("unknown message type:",o,t)}};function c(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.forEach((function(t){var i=t[n];e.beginPath(),e.moveTo(i[0],i[1]);for(var r=i.length>>1,a=1;a<r;a++)e.lineTo(i[a<<1],i[1+(a<<1)]);e.closePath(),e.fill(),o&&e.stroke()}))}function s(e,t){!function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}(e),function(e,t,n){e.strokeStyle="#c5c5c5",e.lineWidth=1,e.fillStyle="#f5f5f5",c(e,t.regions,"fullPath",!0),n&&(e.fillStyle="#e7e7e7",c(e,t.regions,"basePath"))}(e,t,!0),function(e,t){e.lineWidth=1,t.regions.forEach((function(t){var n=t.centerPoint;e.strokeStyle="#a1a1a1",e.beginPath(),e.arc(n.x,n.y,n.iR,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.strokeStyle="#bababa",e.beginPath(),e.arc(n.x,n.y,n.oR,0,2*Math.PI,!1),e.closePath(),e.stroke()}))}(e,t),function(e,t){e.strokeStyle="#f5b",e.lineWidth=2;var n=new Set;t.regions.forEach((function(o){o.neighbors.forEach((function(i){var r=o.id<i?"".concat(o.id,";").concat(i):"".concat(i,";").concat(o.id);if(!n.has(r)){n.add(r);var a=function(e,t){return e.regions[t]}(t,i),c=o.islandId!==a.islandId;e.setLineDash(c?[2,10]:[]),e.beginPath(),e.moveTo(o.centerPoint.x,o.centerPoint.y),e.lineTo(a.centerPoint.x,a.centerPoint.y),e.closePath(),e.stroke()}}))}))}(e,t),function(e,t){e.font="bold 36px sans-serif",e.shadowColor="#fff",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=4,e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",t.regions.forEach((function(t,n){var o=t.centerPoint,i=o.x,r=o.y;e.fillText("".concat(n),i,r)}))}(e,t)}var l=document.getElementById("kiwotigoCanvas"),d=l.getContext("2d"),g=["I will now create a new world just for you ...","Such a thing can take a while, though ...","... each country must be carefully considered ...","Hold on, it can't be much longer ...","I'm almost finished, there's just a few final touches ..."],u=function(e){document.querySelector(".loadingModal-info").innerHTML=e},f=0,h=0,w=function(e){var t=document.querySelector(".loadingModal-content").getBoundingClientRect().width;document.querySelector(".loadingModal-progress").style.width="".concat(Math.round(e*t),"px")},y=function(e){u(g[0]),f=1,document.querySelector(".loadingModal").classList.add("loading"),clearInterval(h),h=setInterval((function(){u(g[f]),f=(f+1)%g.length}),5e3),function(e,t){return new Promise((function(o){var c=a();r.set(c,{resolve:o,onProgressFn:t}),i.postMessage(n(n({},e),{},{id:c}))}))}(e,w).then((function(e){console.log("received new build",e),clearInterval(h),w(1),setTimeout((function(){document.querySelector(".loadingModal").classList.remove("loading")}),500),l.width=e.continent.canvasWidth,l.height=e.continent.canvasHeight;var t=window.devicePixelRatio||1;1!==t&&(l.style.width="".concat(Math.round(l.width/t),"px"),l.style.height="".concat(Math.round(l.height/t),"px")),s(d,e.continent)}))},v=function(){var t=document.forms.kiwotigo.elements;return["gridWidth","gridHeight","gridOuterPaddingX","gridOuterPaddingY","gridInnerPaddingX","gridInnerPaddingY","gridHexWidth","gridHexHeight","hexWidth","hexHeight","hexPaddingX","hexPaddingY","minimalGrowIterations","fastGrowIterations","maxRegionSizeFactor","probabilityCreateRegionAt","maxExtendedOuterRangeFactor","canvasMargin"].reduce((function(o,i){return n(n({},o),{},e({},i,parseFloat(t[i].value)))}),{})};document.forms.kiwotigo.addEventListener("submit",(function(e){e.preventDefault(),y(v()),document.querySelector(".kiwotigo-createContinentBtn").blur()})),document.addEventListener("DOMContentLoaded",(function(){var e=localStorage.getItem("kiwotigoOriginData");e&&y(n(n({},v()),{},{originData:e}))}))}();
//# sourceMappingURL=kiwotigo-demo.js.map
