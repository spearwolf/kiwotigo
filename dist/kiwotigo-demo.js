!function(){"use strict";let e,t,o;const n=new Map,i=(()=>{let e=0;return()=>(++e,"kiwotigo-".concat(e.toString(36)))})(),a=()=>(e||(e=new Worker("kiwotigo.worker.js"),e.onmessage=e=>{let{data:i}=e;const{id:a,type:r}=i,s=n.get(a);if(s)switch(r){case"progress":s.onProgressFn&&s.onProgressFn(i.progress);break;case"result":n.delete(a),delete i.type,i.originData&&localStorage.setItem("kiwotigoOriginData","string"==typeof i.originData?i.originData:JSON.stringify(i.originData)),s.resolve(i),o&&(t={type:"build",data:i},o.postMessage(t));break;default:console.warn("unknown message type:",r,i)}}),e);function r(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.forEach(t=>{const i=t[o];e.beginPath(),e.moveTo(i[0],i[1]);const a=i.length>>1;for(let t=1;t<a;t++)e.lineTo(i[t<<1],i[1+(t<<1)]);e.closePath(),e.fill(),n&&e.stroke()})}function s(e){let{ctx:t,icf:o,...n}=e;!function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}(t),n.drawRegionBoundingBoxes&&function(e,t){let{regions:o}=t;e.strokeStyle="#f0f0f0",o.forEach(t=>{let{bBox:o}=t;e.beginPath(),e.rect(o.left,o.top,o.width,o.height),e.stroke()})}(t,o),function(e,t,o){e.strokeStyle="#a5a5a5",e.lineWidth=1,e.fillStyle="#f5f5f5",r(e,t.regions,"fullPath",!0),o&&(e.fillStyle="#e7e7e7",r(e,t.regions,"basePath"))}(t,o,n.drawRegionBasePaths),n.drawRegionsBase&&function(e,t){e.lineWidth=1,t.regions.forEach(t=>{let{centerPoint:o}=t;e.strokeStyle="#a9a9a9",e.setLineDash([]),e.beginPath(),e.arc(o.x,o.y,o.iR,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.strokeStyle="#cacaca",e.setLineDash([5,15,25]),e.beginPath(),e.arc(o.x,o.y,o.oR,0,2*Math.PI,!1),e.closePath(),e.stroke()})}(t,o),n.drawRegionConnections&&function(e,t){e.setLineDash([]),e.strokeStyle="#f5b",e.lineWidth=3;const o=new Set;t.regions.forEach(n=>{n.neighbors.forEach(i=>{const a=n.id<i?"".concat(n.id,";").concat(i):"".concat(i,";").concat(n.id);if(!o.has(a)){o.add(a);const r=((e,t)=>e.regions[t])(t,i),s=n.islandId!==r.islandId;e.setLineDash(s?[3,6]:[]),e.beginPath(),e.moveTo(n.centerPoint.x,n.centerPoint.y),e.lineTo(r.centerPoint.x,r.centerPoint.y),e.closePath(),e.stroke()}})}),e.setLineDash([])}(t,o),n.drawRegionIds&&function(e,t){e.font="bold 36px sans-serif",e.shadowColor="#fff",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=4,e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",t.regions.forEach((t,o)=>{let{centerPoint:{x:n,y:i}}=t;e.fillText("".concat(o),n,i)})}(t,o)}const c=document.getElementById("kiwotigoCanvas"),d=c.getContext("2d"),l=["I will now create a new world just for you ...","Such a thing can take a while, though ...","... each country must be carefully considered ...","Hold on, it can't be much longer ...","I'm almost finished, there's just a few final touches ..."],g=e=>{document.querySelector(".loadingModal-info").innerHTML=e};let u=0,h=0;const f=e=>{const t=document.querySelector(".loadingModal-content").getBoundingClientRect().width;document.querySelector(".loadingModal-progress").style.width="".concat(Math.round(e*t),"px")},m=()=>document.querySelector(".kiwotigo-form-justUpdate"),y=()=>{const e={};return Array.from(document.querySelectorAll(".mapLegendContainer input[type=checkbox]")).forEach(t=>{e[t.name]=t.checked}),e},p=(()=>{let e;return t=>{e={...e,...t,...y()},s(e)}})(),w=e=>{g(l[0]),u=1,document.querySelector(".loadingModal").classList.add("loading"),clearInterval(h),h=setInterval(()=>{g(l[u]),u=(u+1)%l.length},5e3),((e,t)=>new Promise(o=>{const r=i();n.set(r,{resolve:o,onProgressFn:t}),a().postMessage({...e,id:r})}))(e,f).then(e=>{console.log("received new build",e),clearInterval(h),f(1),setTimeout(()=>{document.querySelector(".loadingModal").classList.remove("loading")},500),m().disabled=!1,document.querySelector(".mapLegendContainer").style.display="block",c.width=e.continent.canvasWidth,c.height=e.continent.canvasHeight,p({ctx:d,icf:e.continent})})},k=()=>{const{elements:e}=document.forms.kiwotigo;return["gridWidth","gridHeight","gridOuterPaddingX","gridOuterPaddingY","gridInnerPaddingX","gridInnerPaddingY","gridHexWidth","gridHexHeight","hexWidth","hexHeight","hexPaddingX","hexPaddingY","minimalGrowIterations","fastGrowIterations","maxRegionSizeFactor","probabilityCreateRegionAt","maxExtendedOuterRangeFactor","canvasMargin"].reduce((t,o)=>({...t,[o]:parseFloat(e[o].value)}),{})},b=()=>localStorage.getItem("kiwotigoOriginData");document.forms.kiwotigo.addEventListener("submit",e=>{e.preventDefault(),m().checked?w({...k(),originData:b()}):w(k()),document.querySelector(".kiwotigo-createContinentBtn").blur()}),document.addEventListener("DOMContentLoaded",()=>{const e=b();if(e){m().disabled=!1;const t=JSON.parse(e).config;w({...t,originData:e}),Array.from(Object.entries(t)).forEach(e=>{let[t,o]=e;const n=document.querySelector(".kiwotigo-form input[name=".concat(t,"]"));n&&(n.value=o)})}else m().disabled=!0,document.querySelector(".mapLegendContainer").style.display="none"}),document.querySelector(".openCloseAction").addEventListener("pointerup",()=>{document.querySelector(".createContinentConfig").classList.toggle("opened")}),m().addEventListener("change",()=>{const{checked:e}=m();Array.from(document.querySelectorAll(".kiwotigo-form .create-only input")).forEach(t=>{t.disabled=e}),document.querySelector(".kiwotigo-form").classList[e?"add":"remove"]("just-update")}),document.querySelector(".mapLegendContainer").addEventListener("change",()=>{console.debug("legend options",y()),p(y())}),document.body.addEventListener("pointerup",e=>{const t=e.target;if("LABEL"===t.tagName){const e=t.getAttribute("for"),o=document.querySelector("input[name=".concat(e,"]"));o&&"checkbox"===o.type&&o.click()}}),o||"undefined"==typeof BroadcastChannel||(o=new BroadcastChannel("kiwotigo"),o.onmessage=e=>{let{data:n}=e;if(n)switch(n.type){case"publishBuild":t&&o.postMessage(t);break;case"ping":o.postMessage({type:"pong"})}},t&&o.postMessage(t))}();
//# sourceMappingURL=kiwotigo-demo.js.map
