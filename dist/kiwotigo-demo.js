!function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){e(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}))}return n}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i,a=new Worker("kiwotigo.worker.js"),c=new Map,l=(i=0,function(){return++i,"kiwotigo-".concat(i.toString(36))});a.onmessage=function(e){var t=e.data,n=t.id,r=t.type,o=c.get(n);if(o)switch(r){case"progress":o.onProgressFn&&o.onProgressFn(t.progress);break;case"result":c.delete(n),delete t.type,t.originData&&localStorage.setItem("kiwotigoOriginData","string"==typeof t.originData?t.originData:JSON.stringify(t.originData)),o.resolve(t);break;default:console.warn("unknown message type:",r,t)}};function u(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.forEach((function(t){var o=t[n];e.beginPath(),e.moveTo(o[0],o[1]);for(var i=o.length>>1,a=1;a<i;a++)e.lineTo(o[a<<1],o[1+(a<<1)]);e.closePath(),e.fill(),r&&e.stroke()}))}function s(e,t){!function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}(e),function(e,t,n){e.strokeStyle="#c5c5c5",e.lineWidth=1,e.fillStyle="#f5f5f5",u(e,t.regions,"fullPath",!0),n&&(e.fillStyle="#e7e7e7",u(e,t.regions,"basePath"))}(e,t,!0),function(e,t){e.lineWidth=1,t.regions.forEach((function(t){var n=t.centerPoint;e.strokeStyle="#a1a1a1",e.beginPath(),e.arc(n.x,n.y,n.iR,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.strokeStyle="#bababa",e.beginPath(),e.arc(n.x,n.y,n.oR,0,2*Math.PI,!1),e.closePath(),e.stroke()}))}(e,t),function(e,t){e.strokeStyle="#f5b",e.lineWidth=2;var n=new Set;t.regions.forEach((function(r){r.neighbors.forEach((function(o){var i=r.id<o?"".concat(r.id,";").concat(o):"".concat(o,";").concat(r.id);if(!n.has(i)){n.add(i);var a=function(e,t){return e.regions[t]}(t,o),c=r.islandId!==a.islandId;e.setLineDash(c?[2,10]:[]),e.beginPath(),e.moveTo(r.centerPoint.x,r.centerPoint.y),e.lineTo(a.centerPoint.x,a.centerPoint.y),e.closePath(),e.stroke()}}))}))}(e,t),function(e,t){e.font="bold 36px sans-serif",e.shadowColor="#fff",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=4,e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",t.regions.forEach((function(t,n){var r=t.centerPoint,o=r.x,i=r.y;e.fillText("".concat(n),o,i)}))}(e,t)}var d=document.getElementById("kiwotigoCanvas"),f=d.getContext("2d"),g=["I will now create a new world just for you ...","Such a thing can take a while, though ...","... each country must be carefully considered ...","Hold on, it can't be much longer ...","I'm almost finished, there's just a few final touches ..."],h=function(e){document.querySelector(".loadingModal-info").innerHTML=e},y=0,m=0,v=function(e){var t=document.querySelector(".loadingModal-content").getBoundingClientRect().width;document.querySelector(".loadingModal-progress").style.width="".concat(Math.round(e*t),"px")},b=function(){return document.querySelector(".kiwotigo-form-justUpdate")},w=function(e){h(g[0]),y=1,document.querySelector(".loadingModal").classList.add("loading"),clearInterval(m),m=setInterval((function(){h(g[y]),y=(y+1)%g.length}),5e3),function(e,t){return new Promise((function(r){var o=l();c.set(o,{resolve:r,onProgressFn:t}),a.postMessage(n(n({},e),{},{id:o}))}))}(e,v).then((function(e){console.log("received new build",e),clearInterval(m),v(1),setTimeout((function(){document.querySelector(".loadingModal").classList.remove("loading")}),500),b().disabled=!1,d.width=e.continent.canvasWidth,d.height=e.continent.canvasHeight;var t=window.devicePixelRatio||1;1!==t&&(d.style.width="".concat(Math.round(d.width/t),"px"),d.style.height="".concat(Math.round(d.height/t),"px")),s(f,e.continent)}))},p=function(){var t=document.forms.kiwotigo.elements;return["gridWidth","gridHeight","gridOuterPaddingX","gridOuterPaddingY","gridInnerPaddingX","gridInnerPaddingY","gridHexWidth","gridHexHeight","hexWidth","hexHeight","hexPaddingX","hexPaddingY","minimalGrowIterations","fastGrowIterations","maxRegionSizeFactor","probabilityCreateRegionAt","maxExtendedOuterRangeFactor","canvasMargin"].reduce((function(r,o){return n(n({},r),{},e({},o,parseFloat(t[o].value)))}),{})},P=function(){return localStorage.getItem("kiwotigoOriginData")};document.forms.kiwotigo.addEventListener("submit",(function(e){e.preventDefault(),b().checked?w(n(n({},p()),{},{originData:P()})):w(p()),document.querySelector(".kiwotigo-createContinentBtn").blur()})),document.addEventListener("DOMContentLoaded",(function(){var e=P();if(e){b().disabled=!1;var t=JSON.parse(e).config;w(n(n({},t),{},{originData:e})),Array.from(Object.entries(t)).forEach((function(e){var t=r(e,2),n=t[0],o=t[1],i=document.querySelector(".kiwotigo-form input[name=".concat(n,"]"));i&&(i.value=o)}))}else b().disabled=!0})),document.querySelector(".openCloseAction").addEventListener("pointerup",(function(){document.querySelector(".createContinentConfig").classList.toggle("opened")})),b().addEventListener("change",(function(){var e=b().checked;Array.from(document.querySelectorAll(".kiwotigo-form .create-only input")).forEach((function(t){t.disabled=e})),document.querySelector(".kiwotigo-form").classList[e?"add":"remove"]("just-update")}))}();
//# sourceMappingURL=kiwotigo-demo.js.map
