!function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){e(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}))}return n}function r(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var a,c,s,u,l=new Map,d=(u=0,function(){return++u,"kiwotigo-".concat(u.toString(36))}),f=function(){return a||((a=new Worker("kiwotigo.worker.js")).onmessage=function(e){var t=e.data,n=t.id,r=t.type,o=l.get(n);if(o)switch(r){case"progress":o.onProgressFn&&o.onProgressFn(t.progress);break;case"result":l.delete(n),delete t.type,t.originData&&localStorage.setItem("kiwotigoOriginData","string"==typeof t.originData?t.originData:JSON.stringify(t.originData)),o.resolve(t),s&&(c={type:"build",data:t},s.postMessage(c));break;default:console.warn("unknown message type:",r,t)}}),a};function g(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.forEach((function(t){var o=t[n];e.beginPath(),e.moveTo(o[0],o[1]);for(var i=o.length>>1,a=1;a<i;a++)e.lineTo(o[a<<1],o[1+(a<<1)]);e.closePath(),e.fill(),r&&e.stroke()}))}function h(e){var t=e.ctx,n=e.icf,o=r(e,["ctx","icf"]);!function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}(t),function(e,t,n){e.strokeStyle="#c5c5c5",e.lineWidth=1,e.fillStyle="#f5f5f5",g(e,t.regions,"fullPath",!0),n&&(e.fillStyle="#e7e7e7",g(e,t.regions,"basePath"))}(t,n,o.drawRegionBasePaths),o.drawRegionsBase&&function(e,t){e.lineWidth=1,t.regions.forEach((function(t){var n=t.centerPoint;e.strokeStyle="#a1a1a1",e.beginPath(),e.arc(n.x,n.y,n.iR,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.strokeStyle="#bababa",e.beginPath(),e.arc(n.x,n.y,n.oR,0,2*Math.PI,!1),e.closePath(),e.stroke()}))}(t,n),o.drawRegionConnections&&function(e,t){e.setLineDash([]),e.strokeStyle="#f5b",e.lineWidth=2;var n=new Set;t.regions.forEach((function(r){r.neighbors.forEach((function(o){var i=r.id<o?"".concat(r.id,";").concat(o):"".concat(o,";").concat(r.id);if(!n.has(i)){n.add(i);var a=function(e,t){return e.regions[t]}(t,o),c=r.islandId!==a.islandId;e.setLineDash(c?[2,10]:[]),e.beginPath(),e.moveTo(r.centerPoint.x,r.centerPoint.y),e.lineTo(a.centerPoint.x,a.centerPoint.y),e.closePath(),e.stroke()}}))})),e.setLineDash([])}(t,n),o.drawRegionIds&&function(e,t){e.font="bold 36px sans-serif",e.shadowColor="#fff",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=4,e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",t.regions.forEach((function(t,n){var r=t.centerPoint,o=r.x,i=r.y;e.fillText("".concat(n),o,i)}))}(t,n)}var y,m=document.getElementById("kiwotigoCanvas"),p=m.getContext("2d"),b=["I will now create a new world just for you ...","Such a thing can take a while, though ...","... each country must be carefully considered ...","Hold on, it can't be much longer ...","I'm almost finished, there's just a few final touches ..."],v=function(e){document.querySelector(".loadingModal-info").innerHTML=e},w=0,S=0,O=function(e){var t=document.querySelector(".loadingModal-content").getBoundingClientRect().width;document.querySelector(".loadingModal-progress").style.width="".concat(Math.round(e*t),"px")},P=function(){return document.querySelector(".kiwotigo-form-justUpdate")},k=function(){var e={};return Array.from(document.querySelectorAll(".mapLegendContainer input[type=checkbox]")).forEach((function(t){e[t.name]=t.checked})),e},x=function(e){h(y=n(n(n({},y),e),k()))},j=function(e){v(b[0]),w=1,document.querySelector(".loadingModal").classList.add("loading"),clearInterval(S),S=setInterval((function(){v(b[w]),w=(w+1)%b.length}),5e3),function(e,t){return new Promise((function(r){var o=d();l.set(o,{resolve:r,onProgressFn:t}),f().postMessage(n(n({},e),{},{id:o}))}))}(e,O).then((function(e){console.log("received new build",e),clearInterval(S),O(1),setTimeout((function(){document.querySelector(".loadingModal").classList.remove("loading")}),500),P().disabled=!1,document.querySelector(".mapLegendContainer").style.display="block",m.width=e.continent.canvasWidth,m.height=e.continent.canvasHeight,x({ctx:p,icf:e.continent})}))},E=function(){var t=document.forms.kiwotigo.elements;return["gridWidth","gridHeight","gridOuterPaddingX","gridOuterPaddingY","gridInnerPaddingX","gridInnerPaddingY","gridHexWidth","gridHexHeight","hexWidth","hexHeight","hexPaddingX","hexPaddingY","minimalGrowIterations","fastGrowIterations","maxRegionSizeFactor","probabilityCreateRegionAt","maxExtendedOuterRangeFactor","canvasMargin"].reduce((function(r,o){return n(n({},r),{},e({},o,parseFloat(t[o].value)))}),{})},I=function(){return localStorage.getItem("kiwotigoOriginData")};document.forms.kiwotigo.addEventListener("submit",(function(e){e.preventDefault(),P().checked?j(n(n({},E()),{},{originData:I()})):j(E()),document.querySelector(".kiwotigo-createContinentBtn").blur()})),document.addEventListener("DOMContentLoaded",(function(){var e=I();if(e){P().disabled=!1;var t=JSON.parse(e).config;j(n(n({},t),{},{originData:e})),Array.from(Object.entries(t)).forEach((function(e){var t=o(e,2),n=t[0],r=t[1],i=document.querySelector(".kiwotigo-form input[name=".concat(n,"]"));i&&(i.value=r)}))}else P().disabled=!0,document.querySelector(".mapLegendContainer").style.display="none"})),document.querySelector(".openCloseAction").addEventListener("pointerup",(function(){document.querySelector(".createContinentConfig").classList.toggle("opened")})),P().addEventListener("change",(function(){var e=P().checked;Array.from(document.querySelectorAll(".kiwotigo-form .create-only input")).forEach((function(t){t.disabled=e})),document.querySelector(".kiwotigo-form").classList[e?"add":"remove"]("just-update")})),document.querySelector(".mapLegendContainer").addEventListener("change",(function(){console.debug("legend options",k()),x(k())})),document.body.addEventListener("pointerup",(function(e){var t=e.target;if("LABEL"===t.tagName){var n=t.getAttribute("for"),r=document.querySelector("input[name=".concat(n,"]"));r&&"checkbox"===r.type&&r.click()}})),s||"undefined"==typeof BroadcastChannel||((s=new BroadcastChannel("kiwotigo")).onmessage=function(e){var t=e.data;if(t)switch(t.type){case"publishBuild":c&&s.postMessage(c);break;case"ping":s.postMessage({type:"pong"})}},c&&s.postMessage(c))}();
//# sourceMappingURL=kiwotigo-demo.js.map
